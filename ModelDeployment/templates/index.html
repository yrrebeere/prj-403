<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Wasail</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.min.css">
    <style>
        body {
            padding: 20px;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Demand Forecasting System</h1>
        <br>

        <form method="POST" action="/predict">
            <div class="form-group">
                <label for="storeSelect">Store</label>
                <select class="form-control" id="storeSelect" name="store">
                    <option value="1" {{ 'selected' if selected_store == '1' else '' }}>1</option>
                    <option value="2" {{ 'selected' if selected_store == '2' else '' }}>2</option>
                    <option value="8" {{ 'selected' if selected_store == '8' else '' }}>8</option>
                </select>
            </div>
            <div class="form-group">
                <label for="productSelect">Product</label>
                <select class="form-control" id="productSelect" name="product">
                    <option value="0" {{ 'selected' if selected_product == '0' else '' }}>0</option>
                    <option value="1" {{ 'selected' if selected_product == '1' else '' }}>1</option>
                    <option value="30" {{ 'selected' if selected_product == '30' else '' }}>30</option>
                </select>
            </div>
            <div class="form-group">
                <label for="modelSelect">Select Model</label>
                <select class="form-control" id="modelSelect" name="model" onchange="toggleDropdowns()">
                    <option value="Prophet" {{ 'selected' if selected_model == 'Prophet' else '' }}>Prophet</option>
                    <option value="Random Forest" {{ 'selected' if selected_model == 'Random Forest' else '' }}>Random Forest</option>
                    <option value="XGBoost" {{ 'selected' if selected_model == 'XGBoost' else '' }}>XGBoost</option>
                    <option value="LightGBM" {{ 'selected' if selected_model == 'LightGBM' else '' }}>LightGBM</option>
                </select>
            </div>
            <div class="form-group">
                <label for="lagSelect">Lag</label>
                <select class="form-control" id="lagSelect" name="lag">
                    <option value="2" {{ 'selected' if selected_lag == '2' else '' }}>Daily</option>
                    <option value="7" {{ 'selected' if selected_lag == '7' else '' }}>Weekly</option>
                    <option value="30" {{ 'selected' if selected_lag == '30' else '' }}>Monthly</option>
                </select>
            </div>
            <div class="form-group">
                <label for="typeSelect">Type</label>
                <select class="form-control" id="typeSelect" name="type" onchange="toggleFeatures()">
                    <option value="Univariate" {{ 'selected' if selected_type == 'Univariate' else '' }}>Univariate</option>
                    <option value="Multivariate" {{ 'selected' if selected_type == 'Multivariate' else '' }}>Multivariate</option>
                </select>
            </div>
            <div class="form-group hidden" id="featuresGroup">
                <label>Features</label><br>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="checkbox" id="featureHoliday" name="features" value="Holiday" {{ 'checked' if 'Holiday' in selected_features else '' }}>
                    <label class="form-check-label" for="featureHoliday">Holiday</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="checkbox" id="featureOilPrices" name="features" value="Oil Prices" {{ 'checked' if 'Oil Prices' in selected_features else '' }}>
                    <label class="form-check-label" for="featureOilPrices">Oil Prices</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="checkbox" id="featurePromotion" name="features" value="Promotion" {{ 'checked' if 'Promotion' in selected_features else '' }}>
                    <label class="form-check-label" for="featurePromotion">Promotion</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="checkbox" id="featureDayOfWeek" name="features" value="Day of Week" {{ 'checked' if 'Day of Week' in selected_features else '' }}>
                    <label class="form-check-label" for="featureDayOfWeek">Day of Week</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="checkbox" id="featureDay" name="features" value="Day" {{ 'checked' if 'Day' in selected_features else '' }}>
                    <label class="form-check-label" for="featureDay">Day</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="checkbox" id="featureMonth" name="features" value="Month" {{ 'checked' if 'Month' in selected_features else '' }}>
                    <label class="form-check-label" for="featureMonth">Month</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="checkbox" id="featureYear" name="features" value="Year" {{ 'checked' if 'Year' in selected_features else '' }}>
                    <label class="form-check-label" for="featureYear">Year</label>
                </div>
            </div>
            <div class="form-group">
                <label for="durationSelect">Prediction</label>
                <select class="form-control" id="durationSelect" name="duration">
                    <option value="Week" {{ 'selected' if selected_duration == 'Week' else '' }}>Week</option>
                    <option value="Month" {{ 'selected' if selected_duration == 'Month' else '' }}>Month</option>
                </select>
            </div>
            <button type="submit" class="btn btn-primary">Predict Sales</button>
        </form>
        <br>
        {% if rmse and rmsle and plot_path %}
            <h2>Predictions</h2>
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Metric</th>
                        <th>Value</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>RMSE</td>
                        <td>{{ rmse }}</td>
                    </tr>
                    <tr>
                        <td>RMSLE</td>
                        <td>{{ rmsle }}</td>
                    </tr>
                </tbody>
            </table>
            <br>

            <h2>Actual vs Predicted Sales</h2>
            <img src="{{ url_for('static', filename='plot.png') }}" alt="Actual vs Predicted Plot" class="img-fluid">
        {% endif %}
    </div>
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.3/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script>
        function toggleDropdowns() {
            var modelSelect = document.getElementById('modelSelect');
            var lagSelect = document.getElementById('lagSelect');
            var typeSelect = document.getElementById('typeSelect');
            if (modelSelect.value === 'Prophet') {
                lagSelect.disabled = true;
                typeSelect.disabled = true;
            } else {
                lagSelect.disabled = false;
                typeSelect.disabled = false;
            }
        }

        function toggleFeatures() {
            var typeSelect = document.getElementById('typeSelect');
            var featuresGroup = document.getElementById('featuresGroup');
            if (typeSelect.value === 'Multivariate') {
                featuresGroup.classList.remove('hidden');
            } else {
                featuresGroup.classList.add('hidden');
            }
        }

        // Call the functions on page load to set the initial state
        window.onload = function() {
            toggleDropdowns();
            toggleFeatures();
        };
    </script>
</body>
</html>
